<!-- ========================================== -->
<!-- admin_login.html -->
<!-- ========================================== -->
{% extends "base.html" %}
{% block content %}
<section class="hero mb-3">
  <h2>Admin Login</h2>
  <p>Sign in to access the admin panel.</p>
</section>

<div class="auth-container">
  <form method="post" action="/auth/jwt/login" class="auth-form card" id="loginForm">
    <div class="form-group">
      <label for="username">Username</label>
      <input type="text" name="username" id="username" required autocomplete="username">
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" name="password" id="password" required
        autocomplete="current-password">
    </div>

    <div id="errorMessage" style="color: #eb5757; margin-bottom: 1rem; display: none;"></div>

    <button type="submit" class="btn btn-full">Sign in</button>
  </form>

  <div class="card mt-2">
    <p class="text-muted"><small>Need access? Ask an administrator to register you via the CLI or database.</small></p>
  </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const formData = new FormData(form);
  const errorDiv = document.getElementById('errorMessage');

  try {
    const response = await fetch('/auth/jwt/login', {
      method: 'POST',
      body: formData,
    });

    if (response.ok) {
      // Successful login - redirect to next URL or admin
      const nextUrl = {{ next_url|tojson }};
      window.location.href = nextUrl;
    } else {
      // Show error message
      const data = await response.json();
      errorDiv.textContent = data.detail || 'Login failed. Please check your credentials.';
      errorDiv.style.display = 'block';
    }
  } catch (error) {
    errorDiv.textContent = 'An error occurred. Please try again.';
    errorDiv.style.display = 'block';
  }
});
</script>
{% endblock %}
