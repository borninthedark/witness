{% extends "admin_base.html" %}
{% block title %}Astrometrics - Admin{% endblock %}

{% block admin_content %}
<section class="hero mb-3">
  <h2>Astrometrics</h2>
  <p>NASA Astronomy Picture of the Day and Near-Earth Object tracking.</p>
</section>

<div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
  <span class="log-stardate">Stardate {{ briefing.stardate }}</span>
  <form method="post" action="/admin/astrometrics/refresh">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <button type="submit" class="btn btn-primary" onclick="this.disabled=true; this.textContent='Refreshing...';">
      Refresh Data
    </button>
  </form>
</div>

<div class="astro-grid">
  <!-- APOD Card -->
  <div class="card astro-apod">
    <h3 class="card-heading">Astronomy Picture of the Day</h3>
    {% if briefing.apod_url %}
      {% if briefing.apod_media_type == "video" %}
      <div class="apod-media">
        <iframe src="{{ briefing.apod_url }}" frameborder="0" allowfullscreen
                style="width: 100%; aspect-ratio: 16/9; border-radius: 6px;"></iframe>
      </div>
      {% else %}
      <div class="apod-media">
        <img src="{{ briefing.apod_url }}" alt="{{ briefing.apod_title }}"
             style="width: 100%; border-radius: 6px;" loading="lazy">
      </div>
      {% endif %}
    {% endif %}
    <h4 style="color: #ccccff; margin: 1rem 0 0.5rem;">{{ briefing.apod_title }}</h4>
    <p style="color: #9999cc; font-size: 0.9rem; line-height: 1.5;">
      {{ briefing.apod_explanation[:500] }}{% if briefing.apod_explanation|length > 500 %}...{% endif %}
    </p>
  </div>

  <!-- NEO Card -->
  <div class="card astro-neo">
    <h3 class="card-heading">Near-Earth Objects</h3>
    <div class="neo-stats">
      <div class="neo-stat">
        <span class="neo-stat-value">{{ briefing.neo_count }}</span>
        <span class="neo-stat-label">Objects Tracked</span>
      </div>
      <div class="neo-stat">
        <span class="neo-stat-label">Closest Approach</span>
        <span class="neo-stat-detail">{{ briefing.neo_closest }}</span>
      </div>
    </div>
    {% if briefing.generated_at %}
    <p class="briefing-meta">
      Updated: {{ briefing.generated_at[:19] }} UTC
    </p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block admin_head_extra %}
<style>
.astro-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.astro-apod {
  grid-column: 1 / 2;
  padding: 1.5rem;
}

.astro-neo {
  padding: 1.5rem;
}

.card-heading {
  color: #ff9900;
  font-size: 1rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0 0 1rem 0;
}

.apod-media {
  margin-bottom: 0.5rem;
}

.neo-stats {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.neo-stat {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.neo-stat-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: #ff9900;
  line-height: 1;
}

.neo-stat-label {
  color: #9999cc;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.neo-stat-detail {
  color: #ccccdd;
  font-size: 0.95rem;
}

.briefing-meta {
  color: #666699;
  font-size: 0.8rem;
  margin-top: 1.5rem;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(153, 153, 204, 0.2);
}

.log-stardate {
  color: #ff9900;
  font-weight: 600;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.btn-primary {
  background: #ff9900;
  color: #1a1a2e;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 0.2s ease;
}

.btn-primary:hover {
  opacity: 0.85;
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

@media (max-width: 768px) {
  .astro-grid {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}
