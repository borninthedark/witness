{% extends "base.html" %}
{% block content %}
<div id="contact-panel" class="mx-auto max-w-2xl p-6 text-gray-100 lcars-panel">
  <h1 class="sr-only">CONTACT â€” LCARS</h1>
  <form method="post" action="/contact" class="space-y-5" id="contact-form">
    <!-- CSRF token for security -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <!-- Honeypot for spam protection -->
    <input type="text" name="honeypot" class="hidden" tabindex="-1" autocomplete="off">

    <div>
      <label class="block text-sm tracking-widest mb-1" style="color: var(--lcars-lilac);">NAME</label>
      <input name="name" type="text" required
        class="w-full lcars-block bg-black/40 border border-white/10 focus:border-[var(--lcars-amber)] outline-none px-4 py-2">
    </div>
    <div>
      <label class="block text-sm tracking-widest mb-1" style="color: var(--lcars-lilac);">EMAIL</label>
      <input name="email" type="email" required
        class="w-full lcars-block bg-black/40 border border-white/10 focus:border-[var(--lcars-amber)] outline-none px-4 py-2">
    </div>
    <div>
      <label class="block text-sm tracking-widest mb-1" style="color: var(--lcars-lilac);">SUBJECT</label>
      <input name="subject" type="text" required
        class="w-full lcars-block bg-black/40 border border-white/10 focus:border-[var(--lcars-amber)] outline-none px-4 py-2">
    </div>
    <div>
      <label class="block text-sm tracking-widest mb-1" style="color: var(--lcars-lilac);">MESSAGE</label>
      <textarea name="message" rows="6" required
        class="w-full lcars-block bg-black/40 border border-white/10 focus:border-[var(--lcars-amber)] outline-none px-4 py-2 resize-none"></textarea>
    </div>

    <!-- reCAPTCHA v2 checkbox - NO data-action attribute for standard v2 -->
    <div class="g-recaptcha" data-sitekey="6Lf0MAwsAAAAAACDDYCJ1_a5kSVvFNQtM0So7__b"></div>

    <div class="flex items-center gap-3">
      <button type="submit" class="lcars-primary-btn px-6 py-2 tracking-widest" id="submit-btn">
        TRANSMIT
      </button>
      <span id="status-msg" class="text-sm"></span>
    </div>
  </form>
</div>

<!-- Load STANDARD reCAPTCHA v2 script (NOT enterprise) -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<script>
  // Check for success parameter in URL (from POST-Redirect-GET pattern)
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('success') === '1') {
    const panel = document.getElementById('contact-panel');
    const form = document.getElementById('contact-form');
    const successDiv = document.createElement('div');
    successDiv.className =
      'lcars-block border border-emerald-400/50 bg-emerald-400/10 p-3 mb-6';
    successDiv.innerHTML =
      '<strong class="text-emerald-300">Success:</strong> Your message has been transmitted.';
    panel.insertBefore(successDiv, form);
  }
</script>
{% endblock %}
